<div *ngIf="chatUser.code == ''">
  <app-header ></app-header>
</div>

<div class="popup" *ngIf="errorMessage !== ''" style="padding: 10px; width: fit-content; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 10px; z-index: 1000;">
  <p style="font-size: 20px; margin: 0;">
      <mat-icon style="vertical-align: middle; margin-right: 8px;" color="warn">warning</mat-icon>
      <b [innerHTML]="errorMessage"></b>
      <button class="close-button" (click)="closePopup()">Ã—</button>
  </p>
</div>

<div *ngIf="auth.isLoggedAdmin()">
  <div *ngIf="chatUser.code == ''" style="padding: 10px; position: relative; bottom: -160px; left: 480px; width: fit-content; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 10px;"> 
    <p style="font-size: 20px"><mat-icon style="vertical-align: middle; margin-right: 8px;" color="warn">warning</mat-icon><b>Nessun utente richiede assistenza tramite chat.</b></p>
  </div>
</div>

<div *ngIf="!auth.isLoggedAdmin()">
  <div *ngIf="chatUser.code == ''" style="padding: 10px; position: relative; bottom: -160px; left: 480px; width: fit-content; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 10px;"> 
    <p style="font-size: 20px"><mat-icon style="vertical-align: middle; margin-right: 8px;" color="warn">warning</mat-icon><b>Attendi che il farmacista sia disponibile.</b></p>
  </div>
</div>

<div *ngIf="chatUser.code !== ''" style="position: relative; bottom: -100px; left: 417px; width: fit-content;">
  <div style="padding: 70px; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 0.5rem;">
    <mat-icon style="position: absolute; top:35px; right: 35px; color: #0062cc" class="icon-display">chat</mat-icon>
    <h3 style="position: absolute; top: 35px; left: 35px; color: #0062cc">{{ auth.isLoggedAdmin() ? '#chat - Farmacista' : '#chat - Utente' }}</h3>
    <div class="messages" #messagesContainer style="background-color: white;">
      <div *ngFor="let messageChat of messages$" [ngClass]="{ 'my-message': messageChat.userDto.username === this.username, 'other-message': messageChat.userDto.username !== this.username }">
        <ng-container *ngIf="messageChat.lastMessage; else notLastMessage">
          <b>{{ messageChat.message }}</b>
        </ng-container>
        <ng-template #notLastMessage>
          <b>{{ messageChat.userDto.username }}</b> : {{ messageChat.message }}
        </ng-template>
      </div>
    </div>
    <div class="input-container">
      <input [(ngModel)]="this.message" placeholder="Inserisci messaggio">
      <button (click)="sendMessage()" [disabled]="!this.message" class="btn btn-primary" >Invia</button>
      <button (click)="closeChatSendMessage()" class="btn btn-primary" >Scollegati</button>
    </div>
  </div>
</div>